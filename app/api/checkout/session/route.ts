import { NextResponse } from 'next/server'; import { getStripe, squarePriceCents } from '@/app/lib/stripe'; export async function POST(req: Request){ const { buyerName, buyerEmail, qty, gameId, boardNumber } = await req.json(); const stripe=getStripe(); const session=await stripe.checkout.sessions.create({ mode:'payment', customer_email: buyerEmail||undefined, line_items:[{ price_data:{ currency:'usd', product_data:{ name:'MNF Squares', description:`Game ${gameId} Board ${boardNumber}` }, unit_amount: squarePriceCents() }, quantity: Number(qty||1) }], metadata:{ buyerName, gameId, boardNumber:String(boardNumber||1) }, success_url:`${process.env.NEXTAUTH_URL||'http://localhost:3000'}/checkout/success?session_id={{CHECKOUT_SESSION_ID}}`, cancel_url:`${process.env.NEXTAUTH_URL||'http://localhost:3000'}/checkout/cancel` }); return NextResponse.json({ url: session.url, id: session.id }); }
